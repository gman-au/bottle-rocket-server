@page "/error"
@using Rocket.Domain.Exceptions
@inject IJSRuntime JsRuntime
<MudGrid Justify="Justify.Center" Class="mt-8">
    <MudItem xs="7">

        @if (Exception == null)
        {
            <MudText
                Typo="Typo.h3"
                Align="Align.Center"
                GutterBottom="true"
                Color="Color.Secondary">
                Not found
            </MudText>
        }
        else
        {
            <MudText
                Typo="Typo.h3"
                Align="Align.Center"
                GutterBottom="true"
                Color="Color.Secondary">
                Error
            </MudText>
        }
    </MudItem>
    <MudItem xs="7">
        @if (Exception == null)
        {
            <div class="d-flex justify-center">
                <MudIcon Style="height: 300px; width: 300px" Color="Color.Warning" Icon="@_notFoundIcon" ViewBox="0 0 50 50"/>
            </div>
        }
        else
        {
            <div class="d-flex justify-center">
                <MudIcon Style="height: 300px; width: 300px" Color="Color.Error" Icon="@_errorIcon" ViewBox="0 0 23 23"/>
            </div>
        }
    </MudItem>
    <MudItem xs="7">
        @if (Exception == null)
        {
            <MudText Align="Align.Center">
                The page or record you are looking for can no longer be found, or you do not have access.
            </MudText>
        }
        else
        {
            <MudText Align="Align.Center">
                An error has occurred. Please contact your administrator.
            </MudText>
            if (Exception is RocketException rex)
            {
                <MudDivider Class="mt-4"/>
                <MudSimpleTable Dense size="Size.Small" Class="mt-4">
                    <tbody>
                    <SimpleTableRowPair Title="API Status code" Value=@rex.ApiStatusCode.ToString()/>
                    <SimpleTableRowPair Title="API Message" Value=@rex.Message/>
                    </tbody>
                </MudSimpleTable>
            }
        }
    </MudItem>
    <MudItem xs="7">
        <div class="d-flex justify-center">
            <MudButton
                Variant="Variant.Outlined"
                Color="Color.Primary"
                @onclick="@(async () => await GoBack())">
                Go Back
            </MudButton>
        </div>
    </MudItem>
</MudGrid>

@code {

    private string _notFoundIcon = @"<svg xmlns='http://www.w3.org/2000/svg'>
            <path fill='currentColor' d='M 28.992188 8.546875 C 23.778469 8.546875 19.384687 11.660687 17.261719 16.070312 C 16.129497 15.28715 14.830797 14.722656 13.355469 14.722656 C 9.6400779 14.722656 6.6525916 17.663812 6.4296875 21.324219 C 2.7059141 22.670439 -5.9211895e-16 26.152406 0 30.330078 C 0 35.658457 4.340656 40 9.6699219 40 L 41.097656 40 C 46.002862 40 50 36.003939 50 31.099609 C 50 26.54878 46.511044 22.918295 42.095703 22.398438 C 42.110713 22.162872 42.142578 21.93944 42.142578 21.695312 C 42.142578 14.444926 36.243594 8.546875 28.992188 8.546875 z M 28.992188 10.546875 C 35.16278 10.546875 40.142578 15.5257 40.142578 21.695312 C 40.142578 22.150412 40.104655 22.610168 40.046875 23.078125 L 39.908203 24.199219 L 41.039062 24.199219 C 41.159062 24.199219 41.17766 24.197266 41.097656 24.197266 C 44.922298 24.197313 48 27.275939 48 31.099609 C 48 34.923279 44.92245 38 41.097656 38 L 9.6699219 38 C 5.4211878 38 2 34.577699 2 30.330078 C 2 26.793709 4.3861186 23.841074 7.6269531 22.945312 L 8.3867188 22.736328 L 8.359375 21.947266 C 8.354375 21.80725 8.3476562 21.737037 8.3476562 21.730469 C 8.3476562 18.952955 10.576792 16.722656 13.355469 16.722656 C 14.744384 16.722656 15.991299 17.284551 16.898438 18.193359 L 18.001953 19.298828 L 18.544922 17.833984 C 20.117523 13.584107 24.185065 10.546875 28.992188 10.546875 z M 24.308594 18 C 24.108594 18 23.996094 18.1125 23.996094 18.3125 L 23.996094 29.6875 C 23.996094 29.8875 24.108594 29.998047 24.308594 29.998047 L 26.734375 29.998047 C 26.934375 29.998047 27.015625 29.8875 27.015625 29.6875 L 27.015625 18.3125 C 27.015625 18.1125 26.934375 18 26.734375 18 L 24.308594 18 z M 24.314453 31.996094 C 24.114453 31.996094 24.001953 32.077344 24.001953 32.277344 L 24.001953 34.6875 C 24.001953 34.8875 24.114453 34.998047 24.314453 34.998047 L 26.691406 34.998047 C 26.891406 34.998047 27.003906 34.8875 27.003906 34.6875 L 27.003906 32.277344 C 27.003906 32.077344 26.891406 31.996094 26.691406 31.996094 L 24.314453 31.996094 z' font-weight='400' font-family='sans-serif' white-space='normal' overflow='visible'/>
        </svg>";

    private string _errorIcon = @"<svg xmlns='http://www.w3.org/2000/svg'>
            <path stroke='currentColor' fill='transparent' d='M2.20164 18.4695L10.1643 4.00506C10.9021 2.66498 13.0979 2.66498 13.8357 4.00506L21.7984 18.4695C22.4443 19.6428 21.4598 21 19.9627 21H4.0373C2.54022 21 1.55571 19.6428 2.20164 18.4695Z' stroke-width='1' stroke-linecap='round' stroke-linejoin='round'/>
            <path d='M12 9V13' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/>
            <path d='M12 17.0195V17' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/>
        </svg>";

    [Parameter]
    public Exception Exception { get; set; }

    [Parameter]
    public ErrorBoundary ErrorBoundary { get; set; }

    private async Task GoBack()
    {
        ErrorBoundary?
            .Recover();

        await
            JsRuntime
                .InvokeVoidAsync(
                    "history.go",
                    -1
                );
    }

}