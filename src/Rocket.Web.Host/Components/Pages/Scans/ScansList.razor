@page "/MyScans"
@using Rocket.Api.Contracts
@using Rocket.Web.Host.Api
@inject IApiRequestManager ApiRequestManager
@inject ISnackbar Snackbar
@inherits Rocket.Web.Host.Infrastructure.CancellableComponentBase

<MudPaper Class="p-4" elevation="2">
    <MudText Typo="Typo.h4">My Scans</MudText>
    <BottleRocketLoadingOverlay IsLoading="@_isLoading">
        <MudGrid Class="pa-4">
            @foreach (var scan in _scans)
            {
                <MudItem xs="12" sm="6" md="4" lg="3" xl="2">
                    <MudCard Outlined>
                        <MudCardMedia
                            Image=@($"data:{scan.ContentType};base64,{scan.ThumbnailBase64}") Width="200" Height="200"/>
                        <MudCardContent>
                            <MudText Typo="Typo.body1">@(scan.DateScanned.ToString("g"))</MudText>
                        </MudCardContent>
                    </MudCard>
                </MudItem>
            }
        </MudGrid>
    </BottleRocketLoadingOverlay>
</MudPaper>

@code {

    private bool _isLoading;

    private IEnumerable<Scan> _scans = [];

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _isLoading = true;
            StateHasChanged();

            var request =
                new MyScansRequest
                {
                    Page = 1,
                    RecordsPerPage = 5
                };

            var response =
                await
                    ApiRequestManager
                        .GetMyScansAsync(
                            request,
                            CancellationToken
                        );

            _scans = response.Scans ?? [];
        }
        catch (Exception ex)
        {
            Snackbar
                .Add(
                    ex.Message,
                    Severity.Error
                );
        }
        finally
        {
            _isLoading = false;
        }
    }

}