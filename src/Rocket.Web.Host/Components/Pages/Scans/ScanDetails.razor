@page "/MyScans/{id}"
@using Rocket.Api.Contracts
@using Rocket.Web.Host.Api
@using Rocket.Web.Host.Infrastructure
@inject IApiRequestManager ApiRequestManager
@inject IWebHostErrorHandler WebHostErrorHandler
@inherits Rocket.Web.Host.Infrastructure.CancellableComponentBase

<BottleRocketLoadingOverlay IsLoading="@_isLoading">
    @if (_scanItemDetail != null)
    {
        <MudGrid Class="pa-8" Justify="Justify.SpaceEvenly">
            <MudItem xs="12" sm="6">
                <MudImage
                    Class="mud-paper mud-paper-outlined"
                    src=@($"data:{_scanItemDetail.ContentType};base64,{_scanItemDetail.ImageBase64}")
                    Fluid
                />
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudStack
                    Style="height:100%;"
                    Justify="Justify.SpaceBetween"
                    StretchItems="StretchItems.Middle"
                    AlignItems="AlignItems.Start"
                >
                    <MudText Class="mb-4" Typo="Typo.h4">
                        Details
                    </MudText>
                    <div style="width:100%;">
                        <MudSimpleTable
                            Bordered
                            Dense
                        >
                            <tbody>
                            <SimpleTableRowPair Title="Capture Date" Value=@_scanItemDetail.CaptureDate.ToString("yyyy-MM-dd HH:mm:ss")/>
                            <SimpleTableRowPair Title="Content Type" Value=@_scanItemDetail.ContentType/>
                            </tbody>
                        </MudSimpleTable>
                    </div>
                    <GoBackButton/>
                </MudStack>
            </MudItem>
        </MudGrid>
    }
</BottleRocketLoadingOverlay>

@code {
    private bool _isLoading;
    private MyScanItemDetail _scanItemDetail = null;

    [Parameter]
    public string Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _isLoading = true;
            StateHasChanged();

            _scanItemDetail =
                await
                    ApiRequestManager
                        .GetMyScanAsync(
                            Id,
                            BaseCancellationToken
                        );
        }
        catch (Exception ex)
        {
            WebHostErrorHandler
                .HandleException(ex);
        }
        finally
        {
            _isLoading = false;
            StateHasChanged();
        }
    }

}